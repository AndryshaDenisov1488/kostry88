* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary-red: #DC143C;
    --primary-white: #FFFFFF;
    --field-green: #228B22;
    --text-dark: #1a1a1a;
    --text-light: #f5f5f5;
    --gold: #FFD700;
    --shadow: rgba(0, 0, 0, 0.3);
}

body {
    font-family: 'Comic Neue', cursive, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    min-height: -webkit-fill-available; /* Для мобильных браузеров */
    overflow: hidden;
    position: relative;
    /* Предотвращение масштабирования на мобильных */
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
    /* Фиксированный размер для корректного отображения */
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
}

.screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1;
}

.screen.active {
    display: flex;
}

/* Стартовый экран */
#startScreen {
    background: linear-gradient(135deg, var(--primary-red) 0%, #8B0000 50%, var(--field-green) 100%);
    color: var(--primary-white);
    text-align: center;
}

.start-content {
    max-width: 600px;
    padding: 20px;
    animation: fadeInUp 0.8s ease;
}

.title {
    font-size: 5rem;
    font-weight: 700;
    margin-bottom: 10px;
    text-shadow: 4px 4px 8px var(--shadow);
    animation: bounce 2s infinite;
}

.subtitle {
    font-size: 2.5rem;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px var(--shadow);
}

.tagline {
    font-size: 1.2rem;
    margin-bottom: 40px;
    opacity: 0.9;
}

.start-buttons {
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: center;
}

/* Карта */
#mapScreen {
    background: var(--field-green);
    overflow: hidden;
    touch-action: pan-y; /* Разрешаем вертикальную прокрутку на мобильных */
    /* 3D перспектива для всего экрана */
    perspective: 2000px;
    -webkit-perspective: 2000px;
}

.map-container {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 100vh;
    overflow: hidden;
    /* Трансформация для движения камеры */
    transform-style: preserve-3d;
    -webkit-transform-style: preserve-3d;
    transition: transform 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    /* Начальное позиционирование - без смещения */
    transform: translate3d(0, 0, 0);
    -webkit-transform: translate3d(0, 0, 0);
    /* Гарантируем, что контейнер занимает весь экран */
    box-sizing: border-box;
}

.map {
    position: absolute;
    /* Карта занимает весь контейнер, но элементы размещаются в пределах viewport */
    width: 100%;
    height: 100%;
    /* Футбольное поле с разметкой */
    background: 
        /* Трава с полосками */
        repeating-linear-gradient(
            90deg,
            #2d5016 0px,
            #2d5016 30px,
            #3a6b1e 30px,
            #3a6b1e 60px
        ),
        repeating-linear-gradient(
            0deg,
            #2d5016 0px,
            #2d5016 30px,
            #3a6b1e 30px,
            #3a6b1e 60px
        ),
        /* Центральный круг */
        radial-gradient(circle at 50% 50%, transparent 15%, rgba(255, 255, 255, 0.3) 15.5%, rgba(255, 255, 255, 0.3) 16.5%, transparent 17%),
        /* Поле */
        linear-gradient(180deg, #87CEEB 0%, var(--field-green) 30%, var(--field-green) 100%);
    background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%;
    /* Гарантируем, что карта всегда имеет размеры */
    box-sizing: border-box;
    /* 3D трансформация для наклона поля */
    transform-style: preserve-3d;
    -webkit-transform-style: preserve-3d;
    transform: rotateX(60deg) rotateZ(-5deg) translateZ(-500px);
    -webkit-transform: rotateX(60deg) rotateZ(-5deg) translateZ(-500px);
    /* Создаём эффект футбольного поля в перспективе */
    will-change: transform;
    /* Позиционирование */
    left: 0;
    top: 0;
    transform-origin: center center;
    -webkit-transform-origin: center center;
}

/* Стадион - трибуны по периметру */
.map::before {
    content: '';
    position: absolute;
    top: -150px;
    left: -150px;
    right: -150px;
    bottom: -150px;
    background: 
        /* Верхняя трибуна */
        repeating-linear-gradient(
            90deg,
            rgba(139, 69, 19, 0.9) 0px,
            rgba(139, 69, 19, 0.9) 40px,
            rgba(160, 82, 45, 0.95) 40px,
            rgba(160, 82, 45, 0.95) 80px
        ),
        linear-gradient(180deg, 
            rgba(101, 67, 33, 0.95) 0%,
            rgba(139, 69, 19, 0.9) 30%,
            rgba(160, 82, 45, 0.9) 50%,
            rgba(139, 69, 19, 0.9) 70%,
            rgba(101, 67, 33, 0.95) 100%
        ),
        /* Нижняя трибуна */
        repeating-linear-gradient(
            90deg,
            rgba(139, 69, 19, 0.9) 0px,
            rgba(139, 69, 19, 0.9) 40px,
            rgba(160, 82, 45, 0.95) 40px,
            rgba(160, 82, 45, 0.95) 80px
        ),
        linear-gradient(0deg, 
            rgba(101, 67, 33, 0.95) 0%,
            rgba(139, 69, 19, 0.9) 30%,
            rgba(160, 82, 45, 0.9) 50%,
            rgba(139, 69, 19, 0.9) 70%,
            rgba(101, 67, 33, 0.95) 100%
        ),
        /* Левая трибуна */
        linear-gradient(90deg,
            rgba(101, 67, 33, 0.95) 0%,
            rgba(139, 69, 19, 0.9) 50%,
            rgba(160, 82, 45, 0.9) 70%,
            rgba(139, 69, 19, 0.9) 100%
        ),
        /* Правая трибуна */
        linear-gradient(270deg,
            rgba(101, 67, 33, 0.95) 0%,
            rgba(139, 69, 19, 0.9) 50%,
            rgba(160, 82, 45, 0.9) 70%,
            rgba(139, 69, 19, 0.9) 100%
        );
    background-size: 
        100% 20%, 
        100% 20%, 
        100% 20%, 
        100% 20%,
        20% 100%,
        20% 100%;
    background-position: 
        top, 
        top, 
        bottom, 
        bottom,
        left,
        right;
    background-repeat: no-repeat;
    pointer-events: none;
    z-index: 0;
    transform: translateZ(-150px);
    -webkit-transform: translateZ(-150px);
    border-radius: 30px;
    box-shadow: 
        inset 0 0 100px rgba(0, 0, 0, 0.5),
        0 0 50px rgba(0, 0, 0, 0.3);
}

/* Ворота по сторонам поля */
.map::after {
    content: '';
    position: absolute;
    top: 30%;
    left: -50px;
    width: 25px;
    height: 30%;
    background: 
        /* Перекладина и штанги ворот */
        linear-gradient(to right,
            #E8E8E8 0%,
            #C0C0C0 5%,
            #C0C0C0 28%,
            transparent 28%,
            transparent 72%,
            #C0C0C0 72%,
            #C0C0C0 95%,
            #E8E8E8 100%
        );
    border: 4px solid #808080;
    border-radius: 3px;
    box-shadow: 
        inset 0 0 15px rgba(0, 0, 0, 0.6),
        inset 0 2px 5px rgba(255, 255, 255, 0.4),
        5px 0 20px rgba(0, 0, 0, 0.4),
        0 0 5px rgba(0, 0, 0, 0.3);
    pointer-events: none;
    z-index: 2;
    transform: translateZ(50px) rotateY(90deg);
    -webkit-transform: translateZ(50px) rotateY(90deg);
}

/* Правые ворота */
.map .goal-right {
    position: absolute;
    top: 30%;
    right: -50px;
    width: 25px;
    height: 30%;
    background: linear-gradient(to left,
        #E8E8E8 0%,
        #C0C0C0 5%,
        #C0C0C0 28%,
        transparent 28%,
        transparent 72%,
        #C0C0C0 72%,
        #C0C0C0 95%,
        #E8E8E8 100%
    );
    border: 4px solid #808080;
    border-radius: 3px;
    box-shadow: 
        inset 0 0 15px rgba(0, 0, 0, 0.6),
        inset 0 2px 5px rgba(255, 255, 255, 0.4),
        -5px 0 20px rgba(0, 0, 0, 0.4),
        0 0 5px rgba(0, 0, 0, 0.3);
    pointer-events: none;
    z-index: 2;
    transform: translateZ(50px) rotateY(-90deg);
    -webkit-transform: translateZ(50px) rotateY(-90deg);
}

.map-path {
    position: absolute;
    width: 60px;
    height: 12px;
    background: 
        /* Бетонные плиты с швами */
        repeating-linear-gradient(
            0deg,
            #888888 0px,
            #888888 48px,
            #999999 48px,
            #999999 50px,
            #888888 50px,
            #888888 98px,
            #999999 98px,
            #999999 100px
        ),
        /* Основа дорожки с текстурой */
        repeating-linear-gradient(
            45deg,
            #707070 0px,
            #707070 2px,
            #808080 2px,
            #808080 4px,
            #909090 4px,
            #909090 6px,
            #808080 6px,
            #808080 8px
        ),
        linear-gradient(135deg,
            #707070 0%,
            #808080 25%,
            #909090 50%,
            #808080 75%,
            #707070 100%
        );
    background-size: 100% 100%, 20px 20px, 100% 100%;
    border-radius: 6px;
    z-index: 1;
    /* 3D эффект для пути */
    transform-style: preserve-3d;
    -webkit-transform-style: preserve-3d;
    /* Добавляем объём дорожки */
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.5),
        inset 0 2px 8px rgba(255, 255, 255, 0.3),
        inset 0 -2px 8px rgba(0, 0, 0, 0.3),
        0 0 2px rgba(0, 0, 0, 0.2);
    /* Текстура бетона */
    border: 1px solid #666666;
    border-top: 2px solid #999999;
}

/* Бетонные плиты в начале */
.concrete-plate {
    position: absolute;
    background: 
        /* Швы между плитами */
        linear-gradient(90deg,
            transparent 0%,
            transparent 48%,
            #666666 48%,
            #666666 52%,
            transparent 52%,
            transparent 100%
        ),
        linear-gradient(0deg,
            transparent 0%,
            transparent 48%,
            #666666 48%,
            #666666 52%,
            transparent 52%,
            transparent 100%
        ),
        /* Текстура бетона */
        repeating-linear-gradient(
            45deg,
            #999999 0px,
            #999999 1px,
            #aaaaaa 1px,
            #aaaaaa 2px,
            #999999 2px,
            #999999 3px,
            #888888 3px,
            #888888 4px
        ),
        linear-gradient(135deg,
            #888888 0%,
            #999999 25%,
            #aaaaaa 50%,
            #999999 75%,
            #888888 100%
        );
    background-size: 100% 100%, 100% 100%, 10px 10px, 100% 100%;
    border-radius: 4px;
    border: 2px solid #777777;
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.6),
        inset 0 2px 10px rgba(255, 255, 255, 0.4),
        inset 0 -2px 10px rgba(0, 0, 0, 0.4),
        0 0 3px rgba(0, 0, 0, 0.3);
    transform-style: preserve-3d;
    -webkit-transform-style: preserve-3d;
    z-index: 1;
}

.map-point {
    position: absolute;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #FFD700;
    border: 3px solid var(--primary-white);
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 3;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    /* 3D эффект для точек */
    transform-style: preserve-3d;
    -webkit-transform-style: preserve-3d;
    transform: translateZ(20px);
    -webkit-transform: translateZ(20px);
    /* Объёмная тень и подсветка */
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5),
                0 0 0 2px rgba(255, 255, 255, 0.5),
                inset 0 2px 10px rgba(255, 255, 255, 0.4),
                inset 0 -2px 5px rgba(0, 0, 0, 0.3);
    /* Анимация "плавания" в 3D пространстве */
    animation: float3d 3s ease-in-out infinite;
}

.map-point.visited {
    background: #32CD32;
}

.map-point.active {
    background: var(--primary-red);
    transform: translateZ(40px) scale(1.3);
    -webkit-transform: translateZ(40px) scale(1.3);
    animation: pulse3d 1.5s infinite, float3d 3s ease-in-out infinite;
    box-shadow: 0 0 30px var(--primary-red),
                0 12px 30px rgba(220, 20, 60, 0.6),
                inset 0 3px 15px rgba(255, 255, 255, 0.5);
}

.map-point.completed {
    background: #4169E1;
}

.map-point.next {
    background: #FFD700;
    cursor: pointer !important;
    animation: nextPointPulse 2s ease-in-out infinite;
}

.map-point.next:hover {
    transform: translateZ(40px) scale(1.2) !important;
    -webkit-transform: translateZ(40px) scale(1.2) !important;
    box-shadow: 0 0 25px #FFD700, 0 10px 30px rgba(255, 215, 0, 0.6) !important;
}

.map-point.hint-highlight {
    animation: hintPulse 1s ease-in-out infinite !important;
    box-shadow: 0 0 40px #FFD700, 0 0 60px #FFD700, 0 0 80px #FFD700 !important;
    transform: translateZ(50px) scale(1.5) !important;
    -webkit-transform: translateZ(50px) scale(1.5) !important;
    z-index: 100 !important;
}

/* Персонаж */
.character {
    position: absolute;
    width: 60px;
    height: 60px;
    z-index: 10;
    pointer-events: none;
    will-change: transform, left, top; /* Оптимизация для анимации */
    /* 3D эффект для персонажа */
    transform-style: preserve-3d;
    -webkit-transform-style: preserve-3d;
    transform: translateZ(50px) rotateY(0deg);
    -webkit-transform: translateZ(50px) rotateY(0deg);
    /* Персонаж "стоит" на поле в 3D */
    transition: transform 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.pig {
    font-size: 50px;
    filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5));
    animation: bounce 0.6s infinite alternate;
}

.character.running .pig {
    animation: run 0.3s infinite, bounce3d 0.6s ease-in-out infinite;
    transform: rotateY(0deg);
    -webkit-transform: rotateY(0deg);
}

.character.running {
    /* При движении персонаж слегка поворачивается и подпрыгивает */
    animation: move3d 1s ease-in-out;
}

.map-ui {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 20;
}

.progress-info {
    background: rgba(255, 255, 255, 0.9);
    padding: 10px 15px;
    border-radius: 20px;
    font-weight: 700;
    color: var(--text-dark);
    box-shadow: 0 4px 8px var(--shadow);
}

/* Задание */
#taskScreen {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: var(--primary-white);
    padding: 20px;
    overflow-y: auto;
}

.task-container {
    max-width: 800px;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 40px var(--shadow);
    color: var(--text-dark);
}

.task-title {
    font-size: 2rem;
    margin-bottom: 30px;
    color: var(--primary-red);
    text-align: center;
}

.task-body {
    margin-bottom: 20px;
}

.question-options {
    display: grid;
    gap: 15px;
    margin: 20px 0;
}

.option-btn {
    padding: 15px 20px;
    background: var(--primary-white);
    border: 3px solid var(--primary-red);
    border-radius: 10px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Comic Neue', cursive;
    text-align: left;
    /* Улучшения для мобильных */
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    min-height: 44px;
    width: 100%;
}

.option-btn:hover {
    background: var(--primary-red);
    color: var(--primary-white);
    transform: translateX(10px);
}

.option-btn.selected {
    background: var(--primary-red);
    color: var(--primary-white);
    font-weight: 700;
}

.option-btn.correct {
    background: #32CD32;
    border-color: #228B22;
    color: var(--primary-white);
}

.option-btn.wrong {
    background: #FF6347;
    border-color: #DC143C;
    color: var(--primary-white);
}

.action-btn {
    padding: 20px 40px;
    font-size: 1.5rem;
    background: var(--primary-red);
    color: var(--primary-white);
    border: none;
    border-radius: 15px;
    cursor: pointer;
    font-family: 'Comic Neue', cursive;
    font-weight: 700;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px var(--shadow);
}

.action-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px var(--shadow);
}

.action-btn:active {
    transform: scale(0.98);
}

.task-feedback {
    margin: 20px 0;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    font-weight: 700;
    font-size: 1.2rem;
}

.task-feedback.success {
    background: #90EE90;
    color: #006400;
}

.task-feedback.funny {
    background: #FFD700;
    color: #8B4513;
}

/* Пенальти игра */
.penalty-game {
    text-align: center;
    padding: 20px;
}

.goal-area {
    position: relative;
    width: 100%;
    max-width: 500px;
    height: 300px;
    min-height: 200px;
    margin: 20px auto;
    background: linear-gradient(180deg, #87CEEB 0%, var(--field-green) 50%);
    border: 5px solid var(--primary-white);
    border-radius: 10px;
    overflow: hidden;
    cursor: pointer;
    touch-action: none; /* Отключаем стандартные жесты для точного определения касания */
    -webkit-tap-highlight-color: transparent; /* Убираем подсветку при касании на мобильных */
}

.goal {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 80px;
    border: 5px solid var(--primary-white);
    border-bottom: none;
    border-top-left-radius: 100px;
    border-top-right-radius: 100px;
    background: transparent;
}

.ball {
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--primary-white);
    border: 3px solid var(--text-dark);
    display: none;
    transition: all 0.5s ease;
}

/* Выбор предметов */
.items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.item-card {
    padding: 20px;
    background: var(--primary-white);
    border: 3px solid var(--primary-red);
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    /* Улучшения для мобильных */
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.item-card:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px var(--shadow);
}

.item-card.selected {
    background: var(--primary-red);
    color: var(--primary-white);
}

.item-emoji {
    font-size: 3rem;
    margin-bottom: 10px;
}

/* Модальное окно */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal.hidden {
    display: none;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
}

.modal-content {
    position: relative;
    background: var(--primary-white);
    border-radius: 20px;
    padding: 30px;
    max-width: 800px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: modalSlideIn 0.3s ease;
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: var(--text-dark);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.modal-close:hover {
    background: var(--primary-red);
    color: var(--primary-white);
}

.modal-title {
    font-size: 1.8rem;
    margin-bottom: 20px;
    color: var(--primary-red);
    text-align: center;
}

.modal-body {
    margin-bottom: 20px;
    text-align: center;
}

.modal-body img {
    max-width: 100%;
    border-radius: 15px;
    box-shadow: 0 4px 15px var(--shadow);
}

.modal-body video {
    max-width: 100%;
    border-radius: 15px;
    box-shadow: 0 4px 15px var(--shadow);
}

.modal-description {
    font-size: 1.1rem;
    line-height: 1.6;
    color: var(--text-dark);
    margin-bottom: 20px;
}

/* Кнопки */
.btn {
    padding: 15px 30px;
    font-size: 1.2rem;
    font-family: 'Comic Neue', cursive;
    font-weight: 700;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px var(--shadow);
    /* Улучшения для мобильных */
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation; /* Убираем задержку на мобильных */
    min-height: 44px; /* Минимальный размер для удобства на мобильных */
    min-width: 44px;
}

.btn-primary {
    background: var(--primary-red);
    color: var(--primary-white);
}

.btn-primary:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px var(--shadow);
}

.btn-secondary {
    background: #808080;
    color: var(--primary-white);
}

.btn-secondary:hover {
    background: #696969;
    transform: scale(1.05);
}

.btn-music {
    background: rgba(255, 255, 255, 0.2);
    color: var(--primary-white);
    border: 2px solid var(--primary-white);
}

.btn-music:hover {
    background: rgba(255, 255, 255, 0.3);
}

.btn-music-small {
    background: rgba(255, 255, 255, 0.9);
    padding: 10px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 1.5rem;
}

.hidden {
    display: none !important;
}

/* Финальный экран */
#finalScreen {
    background: linear-gradient(135deg, var(--primary-red) 0%, #FFD700 50%, var(--field-green) 100%);
    color: var(--primary-white);
    text-align: center;
    overflow-y: auto;
}

.final-content {
    max-width: 800px;
    padding: 40px 20px;
    position: relative;
    z-index: 10;
}

.confetti-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

.confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    background: var(--gold);
    animation: confettiFall 3s linear infinite;
}

.final-title {
    font-size: 4rem;
    margin-bottom: 20px;
    text-shadow: 4px 4px 8px var(--shadow);
    animation: bounce 1s infinite;
}

.final-subtitle {
    font-size: 2rem;
    margin-bottom: 40px;
    text-shadow: 2px 2px 4px var(--shadow);
}

.final-body {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    color: var(--text-dark);
}

/* Экран восстановления */
#restoreScreen {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: var(--primary-white);
}

.restore-content {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    color: var(--text-dark);
    max-width: 500px;
}

.restore-content h2 {
    font-size: 2rem;
    margin-bottom: 20px;
    color: var(--primary-red);
}

.restore-content p {
    font-size: 1.2rem;
    margin-bottom: 30px;
}

.restore-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
}

/* Загрузчик */
.loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    color: var(--primary-white);
}

.loader.hidden {
    display: none;
}

.loader-spinner {
    width: 60px;
    height: 60px;
    border: 5px solid rgba(255, 255, 255, 0.3);
    border-top-color: var(--primary-red);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
}

/* Анимации */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1.3);
    }
    50% {
        transform: scale(1.5);
    }
}

@keyframes run {
    0%, 100% {
        transform: translateY(0) rotate(0deg);
    }
    25% {
        transform: translateY(-5px) rotate(-5deg);
    }
    75% {
        transform: translateY(-5px) rotate(5deg);
    }
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

@keyframes confettiFall {
    to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
    }
}

/* 3D анимации */
@keyframes float3d {
    0%, 100% {
        transform: translateZ(20px) translateY(0);
        -webkit-transform: translateZ(20px) translateY(0);
    }
    50% {
        transform: translateZ(30px) translateY(-5px);
        -webkit-transform: translateZ(30px) translateY(-5px);
    }
}

@keyframes pulse3d {
    0%, 100% {
        transform: translateZ(40px) scale(1.3);
        -webkit-transform: translateZ(40px) scale(1.3);
        box-shadow: 0 0 30px var(--primary-red),
                    0 12px 30px rgba(220, 20, 60, 0.6);
    }
    50% {
        transform: translateZ(50px) scale(1.4);
        -webkit-transform: translateZ(50px) scale(1.4);
        box-shadow: 0 0 40px var(--primary-red),
                    0 15px 40px rgba(220, 20, 60, 0.8);
    }
}

@keyframes bounce3d {
    0%, 100% {
        transform: translateZ(0) rotateY(0deg);
        -webkit-transform: translateZ(0) rotateY(0deg);
    }
    50% {
        transform: translateZ(10px) rotateY(5deg);
        -webkit-transform: translateZ(10px) rotateY(5deg);
    }
}

@keyframes move3d {
    0% {
        transform: translateZ(50px) rotateY(0deg);
        -webkit-transform: translateZ(50px) rotateY(0deg);
    }
    50% {
        transform: translateZ(60px) rotateY(10deg);
        -webkit-transform: translateZ(60px) rotateY(10deg);
    }
    100% {
        transform: translateZ(50px) rotateY(0deg);
        -webkit-transform: translateZ(50px) rotateY(0deg);
    }
}

/* Адаптивность для мобильных - упрощаем 3D эффекты */
@media (max-width: 768px) {
    /* Уменьшаем 3D перспективу на мобильных для производительности */
    #mapScreen {
        perspective: 1000px;
        -webkit-perspective: 1000px;
    }
    
    .map {
        transform: rotateX(45deg) rotateZ(-3deg) translateZ(-300px);
        -webkit-transform: rotateX(45deg) rotateZ(-3deg) translateZ(-300px);
    }
    .title {
        font-size: 3rem;
    }

    .subtitle {
        font-size: 1.8rem;
    }

    .task-container {
        padding: 20px;
        margin: 10px;
    }

    .modal-content {
        padding: 20px;
        width: 95%;
        max-height: 85vh;
    }

    .map-point {
        width: 25px;
        height: 25px;
        font-size: 12px;
    }

    .character {
        width: 50px;
        height: 50px;
    }

    .pig {
        font-size: 40px;
    }

    .final-title {
        font-size: 2.5rem;
    }

    .restore-buttons {
        flex-direction: column;
    }
    
    .goal-area {
        height: 250px;
        max-width: 90%;
    }
    
    .map-path {
        width: 6px;
    }
    
    .map-ui {
        top: 10px;
        right: 10px;
    }
    
    .progress-info {
        padding: 8px 12px;
        font-size: 0.9rem;
    }
    
    .option-btn {
        padding: 12px 15px;
        font-size: 1rem;
    }
    
    .item-card {
        padding: 15px;
    }
    
    .item-emoji {
        font-size: 2.5rem;
    }
}

@media (max-width: 480px) {
    .title {
        font-size: 2.5rem;
    }
    
    .subtitle {
        font-size: 1.5rem;
    }
    
    .task-container {
        padding: 15px;
        margin: 5px;
    }
    
    .goal-area {
        height: 200px;
    }
    
    .map-point {
        width: 20px;
        height: 20px;
        font-size: 10px;
    }
    
    .character {
        width: 40px;
        height: 40px;
    }
    
    .pig {
        font-size: 30px;
    }
    
    .map-ui {
        top: 5px;
        right: 5px;
    }
    
    .progress-info {
        padding: 5px 10px;
        font-size: 0.8rem;
    }
}

/* Улучшения доступности */
button:focus {
    outline: 3px solid var(--gold);
    outline-offset: 2px;
}

/* Предотвращение выделения текста при клике */
.no-select {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

